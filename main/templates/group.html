{% extends "base.html" %}

{% load static %}

{% block head_title %}
{% if title %}{{ title }}{% endif %}
{% endblock %}

{% block navbar %}
<div class="dropdown" style="position: absolute; right: 7%; padding-top: 3px;">
    {% if account.profile_picture %}
    <img src="{{ account.get_profile_picture_address }}" class="rounded-circle" width="40" height="40"></img>
    {% else %}
    <img src="{% static 'img/test.jpeg' %}" class="rounded-circle" width="40" height="40"></img>
    {% endif %}
    <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
        aria-expanded="false">
        {{account.user.get_short_name}}
    </button>
    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
        <a class="dropdown-item" href="">Profile</a>
        <a class="dropdown-item" href="/logout">Logout</a>
        <a class="dropdown-item" href="{{ account.get_add_url }}">Create group</a>
    </div>
</div>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/{{account.get_absolute_url}}">{{account.user.get_short_name}}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{group.group_name}}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<main role="main" class="container">
    <div class="jumbotron">
        <div class="row justify-content-center">
            <div class="col col-10 col-md-2">
                <a type="button" class="btn btn-outline-success" style="width: 100%;" href="add-expense">Add Expense</a>
            </div>
            {% if group.admin_fk == account %}
            <div class="col col-10 col-md-2">
                <a type="button" class="btn btn-outline-primary" style="width: 100%;" data-toggle="collapse"
                    href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Add Member</a>
                <div class="collapse" id="collapseExample">

                    <form method='POST' action='' enctype='multipart/form-data'> {% csrf_token %}
                        <label for="member_id" class="sr-only">Member id</label>
                        <input name="member_id" type="text" class="form-control" placeholder="Member id" required
                            autofocus>
                        <button class="btn btn-outline-dark" type='submit' style="width: 100%;">Add</button>
                    </form>


                </div>
            </div>


            <div class="col col-10 col-md-2">
                <a type="button" class="btn btn-outline-secondary" style="width: 100%;" href="edit-group">Manage
                    Group</a>
            </div>
            <div class="col col-10 col-md-2">
                <a type="button" class="btn btn-outline-danger" style="width: 100%;" href="delete-group">Delete
                    Group</a>
            </div>
            {% endif %}
        </div>

        </br>

        <div class="row justify-content-center">
            {% for member in members %}
            <div class="col col-10 col-sm-5 col-md-2">
                <img class="rounded-circle" src="{% static 'img/test.jpeg' %}" style="width: 100%;">
                </img>
                <h2 style="padding-left: 10%;">{{ member.member_fk.user.first_name }}</h2>
                <p style="padding-left: 10%;">Balance: {{ member.balance|floatformat:2 }}</p>

                <p style="padding-left: 10%;">
                    <button style="width: 100%;" class="btn btn-outline-info" type="button" data-toggle="collapse"
                        data-target="#{{ member.member_fk.user.first_name }}" aria-expanded="false"
                        aria-controls="{{ member.member_fk.user.first_name }}">
                        Details
                    </button>
                </p>
                <div class="collapse" id="{{ member.member_fk.user.first_name }}">
                    <div class="card card-body">
                        {% if member.balance > 0 %}
                        Credits:
                        {% else %}
                        Debts:
                        {% endif %}
                        {% for key, value in details.items %}
                        {% if key == member.member_fk.user.username %}
                        {% for key2, value2 in value.items %}
                        {% if member.balance > 0 %}
                        <p>{{ value2|floatformat:2 }} from {{ key2 }}</p>
                        {% else %}
                        <p>{{ value2|floatformat:2 }} to {{ key2 }}</p>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                        <div style="width: 30%;">
                            <a class="btn btn-primary" href="settle/{{member.member_fk.user.username}}">
                                Settle
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="jumbotron">
        <div class="row justify-content-center">
            {% for expense in expenses %}
            <div class="col col-12 col-sm-6 col-md-4">
                <a class="card-link" href="{{ expense.pk }}">
                    <ul class="list-group">
                        {% if expense.expense_type == 'payment' %}
                        <li class="list-group-item bg-light text-dark">
                            {% endif %}
                            {% if expense.expense_type == 'settle' %}
                        <li class="list-group-item bg-dark text-white">
                            {% endif %}
                            Title: {{ expense.title }}
                            </br>
                            Cost: {{ expense.cost|floatformat:2 }} Tomans
                            </br>
                            Added At: {{ expense.date_time }}
                        </li>
                    </ul>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

</main>
{% endblock %}

{% block js %}
<script>
    $('.popover-dismiss').popover({
        trigger: 'focus'
    })
</script>
{% endblock %}