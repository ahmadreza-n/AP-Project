{% extends "base.html" %}

{% load static %}

{% block head_title %}
{% if title %}{{ title }}{% endif %}
{% endblock %}

{% block navbar %}
{% include 'navbar.html' %}
{% endblock %}

{% block content %}
<div class='col-12 col-md-10 mb-3 mx-auto'>
    <div class='card'>
        <div class='card-body'>
            <p class='card-title'>Group id: {{ group.group_id }}</p>
            <p class='card-title'>Group name: {{ group.group_name }}</p>
            <p class='card-title'>Group admin: {{ group.admin_fk.user.username}}</p>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    {% for member in members %}
    <div class="col col-sm-6 col-lg-3">
        <img class="rounded-circle" src="{% static 'img/test.jpeg' %}" width="180" height="180">
        </img>
        <h2 style="padding-left: 10%;">{{ member.member_fk.user.first_name }}</h2>
        <p style="padding-left: 10%;">Balance: {{ member.balance }}</p>

        <p style="padding-left: 10%;">
            <button class="btn btn-primary" type="button" data-toggle="collapse"
                data-target="#{{ member.member_fk.user.first_name }}" aria-expanded="false"
                aria-controls="{{ member.member_fk.user.first_name }}">
                View details &raquo;
            </button>
        </p>
        <div class="collapse" id="{{ member.member_fk.user.first_name }}">
            <div class="card card-body">
                {% if member.balance > 0 %}
                Credits:
                {% else %}
                Debts:
                {% endif %}
                {% for key, value in details.items %}
                {% if key == member.member_fk.user.username %}
                {% for key2, value2 in value.items %}
                {% if member.balance > 0 %}
                <p>{{ value2 }} from {{ key2 }}</p>
                {% else %}
                <p>{{ value2 }} to {{ key2 }}</p>
                {% endif %}
                {% endfor %}
                {% endif %}
                {% endfor %}
                <div style="width: 30%;">
                    <a class="btn btn-primary" href="settle/{{member.member_fk.user.username}}">
                        Settle
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="row justify-content-center">
    </br>
    {% for expense in expenses %}
    <div class="col col-sm-6 col-lg-4">
        {% if expense.expense_type == 'payment' %}
        <a href="{{ expense.pk }}">
            <ul class="list-group">
                <li class="list-group-item bg-light text-dark">
                    Title: {{ expense.title }}
                    </br>
                    Cost: {{ expense.cost }} Tomans
                    </br>
                    Added At: {{ expense.date_time }}
                </li>
            </ul>
        </a>
        {% endif %}
        {% if expense.expense_type == 'settle' %}
        <a href="{{ expense.pk }}">
            <ul class="list-group">
                <li class="list-group-item bg-dark text-white">
                    Title: {{ expense.title }}
                    </br>
                    Cost: {{ expense.cost }} Tomans
                    </br>
                    Added At: {{ expense.date_time }}
                </li>
            </ul>
        </a>
        {% endif %}
    </div>
    {% endfor %}
</div>




<a class="btn btn-primary" href="add-expense" role="button">Add Record</a>

<br>
<br>

{% if group.admin_fk == account %}

<form method='POST' action='' enctype='multipart/form-data'> {% csrf_token %}
    <label for="member_id" class="sr-only">Member id</label>
    <input name="member_id" type="text" class="form-control" placeholder="Member id" required autofocus>
    <button type='submit'>Add Member</button>
</form>

<a class="btn btn-primary" href="delete-group" role="button">Delete Group</a>
<a class="btn btn-primary" href="edit-group" role="button">Edit Group</a>

{% endif %}

{% endblock %}

{% block js %}
<script>
    $('.popover-dismiss').popover({
        trigger: 'focus'
    })
</script>
{% endblock %}